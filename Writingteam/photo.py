import openai
import os, sys, json
from pathlib import Path

def photo_suggestions(draft):
    
    p = Path(os.path.dirname(__file__))
    parent_folder = p.parent
    
    with open(os.path.join(parent_folder, 'config.json'), 'r') as f:
        config = json.load(f)
    
    API_KEY = config['API_KEY']
    openai.api_key = API_KEY
    
    if getattr(sys, 'frozen', False):
    # The application is running as a bundled executable
        app_path = sys.executable
        p = Path(app_path).parents[1]
        
    else:
    # The application is running as a standard Python script
        app_path = os.path.dirname(os.path.abspath(__file__))
        p = Path(app_path).parents[0]

    # Now application_path will always point to the folder containing your application,
    # whether it's running as a script or as a bundled executable.
    application_path = p.joinpath('Outputs/')
    file_path = os.path.join(application_path, 'blog_post_draft.txt')
    
    with open(file_path, 'r') as f:
        draft = f.read()
    
    system_message = "You are an experienced photographer and understand the intracacies of composition, exposure, focusing, depth of field and other concepts to create engaging images."

    # Construct a conversation with the system message and the blog post draft
    conversation = [
        {"role": "system", "content": system_message},
        {"role": "user", "content": f"Please review the following blog post and provide image suggestions for any relevant content: {draft}. Please include where the image should likely go within the blog post and keywords to search when looking for an image."}
    ]
    
    print("Generating photos to be included... \n")

    # Generate the photo researcher's notes using OpenAI
    MODEL = config['GPT_MODEL']
    response = openai.ChatCompletion.create(
        model="gpt-3.5-turbo",
        messages=conversation
    )

    # Extract the suggestions generated by the AI
    photos = response['choices'][0]['message']['content']
    print("Photo Researchers's Notes Completed! Passing to the Production Editor for Final Content... \n")

    return photos